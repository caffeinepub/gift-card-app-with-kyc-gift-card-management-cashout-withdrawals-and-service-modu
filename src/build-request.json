{
  "kind": "build_request",
  "title": "Restrict withdrawal processing window to 5–20 minutes and update UI messaging",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Enforce a backend rule that a pending withdrawal request can only be marked as #paid within a 5 to 20 minute window after it was created.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Allow the withdrawal to be made between five minutes to 20 minutes"
        ]
      },
      "acceptanceCriteria": [
        "When an admin calls updateWithdrawalStatus(requestId, #paid) less than 5 minutes after the withdrawal request's created timestamp, the backend traps with a clear English error message.",
        "When an admin calls updateWithdrawalStatus(requestId, #paid) more than 20 minutes after the withdrawal request's created timestamp, the backend traps with a clear English error message.",
        "When an admin calls updateWithdrawalStatus(requestId, #paid) between 5 minutes and 20 minutes (inclusive) after created, the update succeeds and processedAt/processedBy are set as currently implemented.",
        "Rejecting a withdrawal (#rejected) is not blocked by the 5–20 minute window (still allowed for pending requests).",
        "The rule is enforced server-side in backend/main.mo (not only in the frontend)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Update withdrawal-related user-facing text and timing indicators to reflect a 5–20 minute processing window in both the Withdrawals page and the Send to Bank review screen.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Allow the withdrawal to be made between five minutes to 20 minutes"
        ]
      },
      "acceptanceCriteria": [
        "In frontend/src/components/crypto/sheets/SendToBankSheet.tsx, replace the review-screen info text 'within 1-3 business days' with 'within 5–20 minutes'.",
        "In frontend/src/pages/withdrawals/WithdrawalsPage.tsx, replace 'Typical processing time: ~10 minutes' with 'Typical processing time: 5–20 minutes'.",
        "In frontend/src/pages/withdrawals/WithdrawalsPage.tsx, update the pending status helper so it no longer assumes a fixed 10-minute countdown; it should reflect the 5–20 minute window (e.g., show queued/estimated before 5 minutes and show time remaining until 20 minutes, then 'Processing...' after 20 minutes).",
        "All updated text is in English and matches the 5–20 minute window consistently across these screens."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Surface the backend 5–20 minute processing-window error to admins when approving a withdrawal so the admin UI shows a helpful toast message instead of a generic failure.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Allow the withdrawal to be made between five minutes to 20 minutes"
        ]
      },
      "acceptanceCriteria": [
        "In frontend/src/pages/admin/AdminWithdrawalsPage.tsx, if approval fails due to the backend window rule, the toast displays the backend-provided error message (or a clear fallback) indicating the 5–20 minute window.",
        "If approval fails for any other reason, existing error handling behavior remains intact.",
        "Reject action behavior remains unchanged."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in backend/main.mo; do not introduce additional backend services.",
    "Do not edit any files under frontend/src/components/ui or other immutablePaths listed in SYSTEM_CONTEXT; compose existing UI components instead.",
    "Use English for any user-facing text related to this change."
  ],
  "nonGoals": [
    "Do not add new authentication providers or third-party services.",
    "Do not implement real-time processing/streaming updates (no websockets/push).",
    "Do not change withdrawal amount calculations, KYC rules, or payout method ownership checks beyond the requested timing-window behavior."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}