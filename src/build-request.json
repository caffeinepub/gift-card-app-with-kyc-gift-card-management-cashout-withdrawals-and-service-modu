{
  "kind": "build_request",
  "title": "Add backend support for gift_card_rates (brand rates with active/inactive status)",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Implement backend storage for a gift card rates table named `gift_card_rates` with fields: `id`, `brand_name`, `rate_percentage`, and `status` (active/inactive).",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "If you don’t have backend knowledge, tell your developer to create a table called:\n\ngift_card_rates\n\nWith fields:\n\t•\tid\n\t•\tbrand_name\n\t•\trate_percentage\n\t•\tstatus (active/inactive)",
          "Please go ahead and set it up"
        ]
      },
      "acceptanceCriteria": [
        "A new `GiftCardRate` (or equivalent) type exists in `backend/main.mo` with fields corresponding to `id`, `brand_name`, `rate_percentage`, and `status` (active/inactive).",
        "Backend maintains an auto-incrementing id counter for gift card rates, similar to existing `_next...Id` patterns in `backend/main.mo`.",
        "Gift card rate records are stored in backend state (in-memory Map consistent with the current codebase patterns)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Expose backend methods for admins to create, update, and deactivate/reactivate entries in `gift_card_rates`, and expose query methods to list rates and fetch the active rate for a given `brand_name`.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Please go ahead and set it up"
        ]
      },
      "acceptanceCriteria": [
        "Admin-only endpoints are protected with the same admin gating pattern used elsewhere (e.g., `AccessControl.isAdmin(...)`), trapping on unauthorized access.",
        "There is an admin method to create a rate entry with `brand_name`, `rate_percentage`, and `status`.",
        "There is an admin method to update an existing rate entry by `id` (at minimum allowing changing `rate_percentage` and `status`).",
        "There is a query method to list all gift card rate entries (admin-only or public as appropriate, but must be explicitly defined).",
        "There is a query method to get the active `rate_percentage` for a provided `brand_name` that returns `null`/`?` when the brand has no active rate."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single-actor Motoko canister; do not introduce additional canisters/services.",
    "All Motoko logic must live in `backend/main.mo`; create `backend/migration.mo` only if it is strictly required for state upgrades.",
    "Use English for any user-facing text."
  ],
  "nonGoals": [
    "Do not implement an external SQL database or any non-Internet-Computer database integration.",
    "Do not redesign the existing gift card UI or replace the existing static NGN tier configuration unless explicitly requested."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}